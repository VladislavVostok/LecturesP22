# Отношения между таблицами в Entity Framework Core

**Тема:** "Фитнес-трекер" - настройка связей между сущностями.

---

## **Цель задания**

Научиться настраивать отношения между таблицами в Entity Framework Core:
- Настроить связи One-to-Many, Many-to-Many
- Понять навигационные свойства и внешние ключи
- Создать связующую таблицу для реализации связи Many-to-Many

---

## **Описание задания**

Преобразуйте существующий фитнес-трекер с независимыми таблицами в реляционную базу данных с правильными связями.

---

## **Что нужно сделать:**

### **Шаг 1: Определите связи между таблицами**

1. **Client ↔ WorkoutSession** (Один ко многим)
   - У одного клиента может быть много тренировок
   - У каждой тренировки может быть только один клиент

2. **Trainer ↔ WorkoutSession** (Один ко многим)
   - У одного тренера может быть много тренировок
   - У каждой тренировки может быть только один тренер

3. **Exercise ↔ WorkoutSession** (Многие ко многим)
   - Одна тренировка содержит много упражнений
   - Одно упражнение используется во многих тренировках

### **Шаг 2: Добавьте внешние ключи и навигационные свойства**

**В класс Client добавьте:**
- Коллекцию тренировок: `ICollection<WorkoutSession> WorkoutSessions`

**В класс Trainer добавьте:**
- Коллекцию тренировок: `ICollection<WorkoutSession> WorkoutSessions`

**В класс WorkoutSession добавьте:**
- Внешние ключи: `ClientId` и `TrainerId`
- Навигационные свойства: `Client` и `Trainer`
- Коллекцию упражнений: `ICollection<WorkoutExercise> WorkoutExercises`

**В класс Exercise добавьте:**
- Коллекцию: `ICollection<WorkoutExercise> WorkoutExercises`

**Создайте новый класс WorkoutExercise (связующая таблица):**
- Первичный ключ `Id`
- Внешние ключи: `WorkoutSessionId` и `ExerciseId`
- Дополнительные поля: `Sets` (подходы), `Repetitions` (повторения), `Weight` (вес)
- Навигационные свойства: `WorkoutSession` и `Exercise`

### **Шаг 3: Настройте связи через Fluent API**

В каждом классе конфигурации пропишите:

**ClientConfiguration:**
- Настройте связь один ко многим с WorkoutSession
- Установите поведение при удалении `SetNull`

**TrainerConfiguration:**
- Настройте связь один ко многим с WorkoutSession
- Установите поведение при удалении `SetNull`

**WorkoutSessionConfiguration:**
- Настройте связи один ко многим с Client и Trainer
- Настройте связь один ко многим с WorkoutExercise

**ExerciseConfiguration:**
- Настройте связь один ко многим с WorkoutExercise

**WorkoutExerciseConfiguration:**
- Настройте первичный ключ
- Настройте связи с WorkoutSession и Exercise
- Создайте уникальный индекс по паре WorkoutSessionId + ExerciseId

### **Шаг 4: Создайте и примените миграцию**

1. Создайте новую миграцию:
   ```bash
   dotnet ef migrations add AddRelationships
   ```
2. Примените миграцию:
   ```bash
   dotnet ef database update
   ```
3. Проверьте структуру базы данных через pgAdmin или DBeaver

### **Шаг 5: Добавьте простые операции CRUD**

Расширьте консольное меню:

**Для WorkoutSession:**
- Создание тренировки с выбором клиента и тренера
- Добавление упражнения в существующую тренировку
- Удаление тренировки
- Просмотр тренировок клиента

**Для WorkoutExercise:**
- Добавление упражнения в тренировку с указанием подходов и повторений
- Изменение параметров упражнения в тренировке
- Удаление упражнения из тренировки

---

## **Что нужно сдать:**

1. **Обновленный исходный код проекта** со всеми связями
2. **Файлы миграций** (.cs файлы) для добавления связей
3. **SQL-скрипт** создания связей
4. **Скриншоты работы приложения** с демонстрацией:
   - Создания связей между таблицами
   - Добавления упражнений в тренировку
   - Просмотра структуры таблиц в pgAdmin

5. **Краткий отчет** о возникших проблемах с настройкой связей

---

## **Подсказки:**

- Используйте `virtual` для навигационных свойств
- Помните о необходимости инициализации коллекций через `new List<>()`
- Не забудьте применить правильное поведение при удалении (cascade, set null, restrict)
- Для связи Many-to-Many всегда нужна связующая таблица