## 1. Общее описание проекта

**Protondoro** — веб-приложение для управления временем по методике Pomodoro, реализующее клиент-серверную архитектуру с возможностью синхронизации данных между устройствами. Приложение предоставляет базовый функционал бесплатно, с расширенными возможностями по подписке.

**Целевая аудитория:** Студенты, фрилансеры, офисные работники, все, кто хочет повысить продуктивность через структурированные интервалы работы и отдыха.

**Основные технологии:**
- **Бэкенд:** ASP.NET Core Web API (версия 8/9)
- **Фронтенд:** React 18+ с TypeScript, Node.js для сборки
- **База данных:** PostgreSQL
- **Аутентификация:** JWT Tokens, OAUTH черeз github.com, vk.com и прочее.
- **Стилизация:** CSS-фреймворк (Tailwind CSS/MUI) с поддержкой кастомных тем
- **Деплой:** Docker-контейнеризация, возможность развертывания на VPS/облачных платформах

---

## 2. Функциональные требования

### 2.1. Модуль аутентификации и авторизации
- Регистрация нового пользователя (email/пароль)
- Вход в систему (email/пароль, позже можно добавить OAuth через Google/GitHub)
- Восстановление пароля
- Подтверждение email
- Разделение на роли: **Бесплатный пользователь**, **Премиум-пользователь**
- Выход из системы

### 2.2. Модуль управления задачами и проектами (Projects & Tasks)

#### 2.2.1. Проекты (Projects)
- Пользователь может создавать/редактировать/удалять проекты (например: "Разработка Protondoro", "Учёба", "Личные дела")
- У каждого проекта есть:
  - Название
  - Описание (опционально)
  - Цветовая метка (для визуального различения)
  - Дата создания
  - Список категорий внутри проекта

#### 2.2.2. Категории (Categories) или Пулы задач (Pool tasks)
- Внутри проекта можно создавать категории (например: "Срочные", "На этой неделе", "Утренние", "Рабочие", "Домашние")
- Возможность переименовывать, удалять категории, менять их порядок (Drag & Drop для порядка)
- **Ограничение:** Для бесплатных пользователей — максимум 3 проекта, в каждом до 3 категорий. Премиум — без ограничений.

#### 2.2.3. Задачи (Tasks)
- Создание задачи с обязательными полями:
  - Заголовок
  - Принадлежность к категории (и к проекту соответственно)
  - Оценочное количество "помидорок" (стандартный помидор = 25 мин)
- Опциональные поля:
  - Подробное описание
  - Дата дедлайна
  - Приоритет (низкий, средний, высокий)
  - Прикрепление картинки (сохранять в облачное хранилище, например, AWS S3 или аналоги, ссылку в БД) — **Easy**
  - Чек-лист внутри задачи (подзадачи)
- **Основной список (Main Tasks List):** Задачи из разных категорий можно перетаскивать в основной список на "сегодня/сейчас". Drag & Drop между категориями и основным списком — **Middle**
- В основном списке задачи можно отмечать как выполненные, редактировать, удалять.
- **Ограничение:** Бесплатно — максимум 15 активных задач одновременно. Премиум — без ограничений.

### 2.3. Модуль таймера Pomodoro

#### 2.3.1. Основной интерфейс таймера
- Крупный таймер с оставшимся временем
- Кнопки управления:
  - **Start** — запуск таймера текущего интервала
  - **Pause** — пауза
  - **Skip** — пропустить текущий интервал
  - **Reset** — сбросить текущий интервал к начальному значению
  - **Stop** — остановить сессию полностью (сбросить до выбора задачи)
- Визуальная индикация типа интервала:
  - Работа (Pomodoro) — красный
  - Короткий перерыв — зелёный
  - Длинный перерыв — синий
- Текущая задача (выбранная из основного списка) отображается под/над таймером
- **Режим "Дзен"**: по нажатию кнопки скрывается весь интерфейс, кроме таймера и, возможно, текущей задачи. Повторное нажатие — возврат.

#### 2.3.2. Настройки таймера
- Возможность изменять длительности (в минутах):
  - Pomodoro (работа) — по умолчанию 25
  - Короткий перерыв — по умолчанию 5
  - Длинный перерыв — по умолчанию 15
- Настройка количества Pomodoro перед длинным перерывом (по умолчанию 4)
- Автозапуск перерывов и/или Pomodoro (опция)
- Уведомления (звуковые, браузерные) при завершении интервала. Выбор звука/мелодии.
- **Для неавторизованных пользователей:** используются только настройки по умолчанию, изменения не сохраняются.

### 2.4. Аналитика и трекер продуктивности (Statistics) — **Middle**
- Графики и диаграммы за выбранный период (день, неделя, месяц, произвольный диапазон)
- Основные метрики:
  - Количество завершённых Pomodoro за период
  - Общее время фокусировки
  - Распределение по проектам/категориям
  - Динамика продуктивности (сравнение дней/недель)
  - Самые частые задачи
- Экспорт данных в CSV/PDF (для премиум)
- Еженедельный отчёт на email (опционально, для премиум)

### 2.5. Система тем и кастомизации интерфейса — **Hard**
- Несколько предустановленных тем (светлая, тёмная, sepia)
- **Кастомные темы для премиум-пользователей:**
  - Выбор основного цвета таймера
  - Выбор фонового изображения/цвета
  - Выбор цвета текста и элементов интерфейса
  - Сохранение нескольких тем, быстрая смена

### 2.6. Система подписки (Premium)
- Страница с тарифами и преимуществами
- Интеграция с платёжным шлюзом (Stripe/PayPal/ЮKassa/Yandex и прочии)
- Автоматическое обновление статуса пользователя после успешной оплаты
- Ограничение функционала для бесплатных пользователей (см. выше)
- История платежей (в личном кабинете)

### 2.7. Дополнительные функции (вдохновлено pomofocus.io и pomodoro-tracker.com)
- **Уведомления в браузере** (независимо от активной вкладки)
- **Фоновый звук/белый шум** на время работы (выбор из нескольких, для премиум)
- **Горячие клавиши** (Space — старт/пауза, N — следующий, R — сброс и т.д.)
- **Трекер отвлечений**: кнопка "Я отвлёкся" во время Pomodoro, запись причины (опционально)
- **Цели на день**: планирование количества Pomodoro на день, отслеживание выполнения
- **Публичные профили/доски лидеров** (опционально, для вовлечения)
- **REST API для сторонних разработчиков** (частичный, для премиум)

---

## 3. Нефункциональные требования

Это общие требования для работы приложения на сервере.
### 3.1. Производительность
- Время загрузки главной страницы < 2 сек
- Отклик на действия пользователя (клики, drag & drop) < 200 мс
- Таймер должен работать точно, синхронизироваться с серверным временем при необходимости

### 3.2. Безопасность
- HTTPS на всех endpoint'ах
- Защита от XSS, CSRF, SQL-инъекций
- Хэширование паролей (bcrypt/scrypt)
- JWT токены с разумным временем жизни, refresh tokens
- Валидация всех входных данных на сервере

### 3.3. Надёжность
- Доступность 99.5%
- Резервное копирование базы данных ежедневно
- Логирование ошибок и критических действий

### 3.4. Масштабируемость
- Возможность горизонтального масштабирования бэкенда
- Статика отдаётся через CDN

### 3.5. Кросс-платформенность и отзывчивый дизайн
- Полная поддержка десктопных браузеров (Chrome, Firefox, Safari, Edge)
- Адаптивный дизайн для планшетов и мобильных устройств (такой же функционал, кроме, возможно, сложного drag & drop на мобилках — заменить долгим нажатием и меню)

## 4. Модель данных (основные сущности в PostgreSQL)

```sql
-- Пользователи
CREATE TABLE Users (
    Id UUID PRIMARY KEY,
    Email VARCHAR(255) UNIQUE NOT NULL,
    PasswordHash VARCHAR(255) NOT NULL,
    Username VARCHAR(100),
    CreatedAt TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    IsEmailConfirmed BOOLEAN DEFAULT FALSE,
    Role VARCHAR(20) DEFAULT 'Free', -- 'Free', 'Premium'
    SubscriptionEndDate TIMESTAMP WITH TIME ZONE NULL,
    ThemeSettings JSONB DEFAULT '{}' -- настройки тем
);

-- Проекты
CREATE TABLE Projects (
    Id UUID PRIMARY KEY,
    UserId UUID REFERENCES Users(Id) ON DELETE CASCADE,
    Title VARCHAR(255) NOT NULL,
    Description TEXT,
    Color VARCHAR(7), -- hex, например #FF5733
    Position INT, -- для порядка
    CreatedAt TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Категории внутри проектов
CREATE TABLE Categories (
    Id UUID PRIMARY KEY,
    ProjectId UUID REFERENCES Projects(Id) ON DELETE CASCADE,
    Title VARCHAR(255) NOT NULL,
    Position INT,
    CreatedAt TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Задачи
CREATE TABLE Tasks (
    Id UUID PRIMARY KEY,
    CategoryId UUID REFERENCES Categories(Id) ON DELETE CASCADE,
    Title VARCHAR(500) NOT NULL,
    Description TEXT,
    EstimatedPomodoros INT DEFAULT 1,
    CompletedPomodoros INT DEFAULT 0,
    IsCompleted BOOLEAN DEFAULT FALSE,
    Priority INT DEFAULT 2, -- 1-высокий, 2-средний, 3-низкий
    Deadline TIMESTAMP WITH TIME ZONE NULL,
    ImageUrl VARCHAR(500) NULL, -- ссылка на картинку
    Position INT, -- позиция в категории
    IsInMainList BOOLEAN DEFAULT FALSE, -- находится ли в основном списке на сегодня
    CreatedAt TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    CompletedAt TIMESTAMP WITH TIME ZONE NULL
);

-- Подзадачи (чек-лист)
CREATE TABLE Subtasks (
    Id UUID PRIMARY KEY,
    TaskId UUID REFERENCES Tasks(Id) ON DELETE CASCADE,
    Title VARCHAR(500) NOT NULL,
    IsCompleted BOOLEAN DEFAULT FALSE,
    Position INT
);

-- Записи Pomodoro сессий (для аналитики)
CREATE TABLE PomodoroSessions (
    Id UUID PRIMARY KEY,
    UserId UUID REFERENCES Users(Id) ON DELETE CASCADE,
    TaskId UUID REFERENCES Tasks(Id) ON DELETE SET NULL,
    StartTime TIMESTAMP WITH TIME ZONE NOT NULL,
    EndTime TIMESTAMP WITH TIME ZONE NOT NULL,
    Duration INT NOT NULL, -- в секундах
    Type VARCHAR(20) NOT NULL, -- 'Work', 'ShortBreak', 'LongBreak'
    WasInterrupted BOOLEAN DEFAULT FALSE,
    InterruptionReason TEXT NULL
);

-- Настройки таймера пользователя
CREATE TABLE UserTimerSettings (
    UserId UUID PRIMARY KEY REFERENCES Users(Id) ON DELETE CASCADE,
    PomodoroDuration INT DEFAULT 1500, -- в секундах (25 мин)
    ShortBreakDuration INT DEFAULT 300, -- 5 мин
    LongBreakDuration INT DEFAULT 900, -- 15 мин
    LongBreakInterval INT DEFAULT 4, -- через сколько помидоров длинный перерыв
    AutoStartBreaks BOOLEAN DEFAULT FALSE,
    AutoStartPomodoros BOOLEAN DEFAULT FALSE,
    SoundEnabled BOOLEAN DEFAULT TRUE,
    SoundType VARCHAR(50) DEFAULT 'bell',
    UpdatedAt TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

## 5. REST API (основные endpoint'ы)

### 5.1. Аутентификация
- `POST /api/auth/register` – регистрация
- `POST /api/auth/login` – вход
- `POST /api/auth/refresh` – обновление токена
- `POST /api/auth/forgot-password` – запрос на сброс пароля
- `POST /api/auth/reset-password` – сброс пароля

### 5.2. Пользователь и настройки
- `GET /api/user/profile` – получение профиля
- `PUT /api/user/profile` – обновление профиля
- `GET /api/user/settings/timer` – настройки таймера
- `PUT /api/user/settings/timer` – обновление настроек таймера
- `GET /api/user/settings/theme` – настройки темы
- `PUT /api/user/settings/theme` – обновление темы

### 5.3. Проекты и категории
- `GET /api/projects` – список проектов
- `POST /api/projects` – создание проекта
- `PUT /api/projects/{id}` – обновление проекта
- `DELETE /api/projects/{id}` – удаление проекта
- `POST /api/projects/reorder` – изменение порядка проектов (Drag & Drop)
- `GET /api/projects/{projectId}/categories` – категории проекта
- `POST /api/projects/{projectId}/categories` – создание категории
- `PUT /api/categories/{id}` – обновление категории
- `DELETE /api/categories/{id}` – удаление категории
- `POST /api/categories/reorder` – изменение порядка категорий

### 5.4. Задачи
- `GET /api/tasks/main` – задачи основного списка (IsInMainList = true)
- `GET /api/tasks/category/{categoryId}` – задачи категории
- `POST /api/tasks` – создание задачи
- `PUT /api/tasks/{id}` – обновление задачи
- `DELETE /api/tasks/{id}` – удаление задачи
- `PUT /api/tasks/{id}/toggle-completion` – отметка выполнения
- `PUT /api/tasks/{id}/move-to-main` – переместить в основной список
- `POST /api/tasks/reorder` – изменение порядка задач (внутри категории/основного списка)
- `POST /api/tasks/{id}/image` – загрузка картинки для задачи

### 5.5. Pomodoro сессии (Пока думаю, что нужно на фронте, но на фронте можно будет абузить уязвимости JS)
- `POST /api/pomodoro/start` – начать сессию (с привязкой к задаче)
- `POST /api/pomodoro/complete` – завершить сессию (или пропустить)
- `POST /api/pomodoro/interrupt` – отметить прерывание

### 5.6. Аналитика
- `GET /api/analytics/summary?from=&to=` – сводка за период
- `GET /api/analytics/project-stats?projectId=&from=&to=` – статистика по проекту
- `GET /api/analytics/export?format=csv&from=&to=` – экспорт данных

### 5.7. Премиум и платежи
- `GET /api/subscription/plans` – доступные тарифы
- `POST /api/subscription/create-checkout-session` – создать сессию оплаты
- `GET /api/subscription/status` – статус подписки
- `POST /api/subscription/cancel` – отмена подписки

## 6. Архитектура фронтенда (React)

### 6.1. Структура компонентов (примерная)
```
src/
├── components/
│   ├── common/           (кнопки, инпуты, модалки)
│   ├── layout/           (шапка, сайдбар, футер)
│   ├── timer/            (таймер, кнопки управления, режим Дзен)
│   ├── tasks/            (список задач, карточка задачи, drag & drop)
│   ├── projects/         (список проектов, создание/редактирование)
│   ├── categories/       (категории внутри проекта)
│   ├── analytics/        (графики, таблицы статистики)
│   └── settings/         (настройки таймера, темы)
├── pages/
│   ├── HomePage.tsx      (главная с таймером и основным списком задач)
│   ├── LoginPage.tsx
│   ├── RegisterPage.tsx
│   ├── ProjectsPage.tsx
│   ├── AnalyticsPage.tsx
│   └── SettingsPage.tsx
├── store/                (состояние, Redux Toolkit или Zustand)
├── services/             (API вызовы к бэкенду)
├── hooks/                (кастомные хуки)
├── utils/                (вспомогательные функции)
└── styles/               (глобальные стили, темы)
```

### 6.2. Состояние (State Management)
- **Redux Toolkit** или **Zustand** для глобального состояния (пользователь, настройки, список задач)
- **React Context** для темы и локальных состояний
- **React Query** или SWR для кэширования данных с сервера (списки проектов, задач, аналитика)

### 6.3. Drag & Drop
- Использовать библиотеку **@dnd-kit** (современная, производительная) для перетаскивания задач между категориями и основным списком.

### 6.4. Стилизация
- **Tailwind CSS** для быстрой разработки с кастомными классами
- Поддержка динамической смены тем через CSS Variables

---

## 7. Конкретные задачи для выполнения (Roadmap)

### Этап 1: Базовый каркас
1. Настроить проект ASP.NET Core Web API с PostgreSQL
2. Реализовать базовую аутентификацию (регистрация, вход, JWT)
3. Создать миграции для основных таблиц (Users, Projects, Categories, Tasks)
4. Развернуть проект React с роутингом и базовой структурой
5. Сверстать главную страницу с таймером (статичным) и кнопками управления
6. Реализовать таймер на фронтенде (логика работы, без сохранения)

### Этап 2: Управление задачами
1. CRUD для проектов и категорий (бэкенд + фронтенд)
2. CRUD для задач (бэкенд + фронтенд)
3. Drag & Drop для задач между категориями и основным списком
4. Прикрепление картинок к задачам (бэкенд: загрузка файлов, фронтенд: компонент загрузки)

### Этап 3: Интеграция таймера с задачами
1. Сохранение настроек таймера для авторизованных пользователей
2. Привязка запуска таймера к выбранной задаче
3. Запись завершённых Pomodoro сессий в БД
4. Отображение текущей задачи под таймером

### Этап 4: Аналитика и расширенные функции
1. Разработка страницы аналитики с графиками (использовать Recharts или Chart.js)
2. Реализация системы тем (предустановленных + кастомных для премиум)
3. Добавление дополнительных функций: звуки, уведомления, горячие клавиши

### Этап 5: Премиум и платежи
1. Интеграция платёжного шлюза
2. Реализация логики ограничений для бесплатных пользователей
3. Страница подписки и управления подпиской

### Этап 6: Полировка и тестирование
1. Адаптивный дизайн для мобильных устройств
2. Написание unit-тестов для критичного функционала (бэкенд)
3. Тестирование пользовательских сценариев, фикс багов
4. Настройка CI/CD (GitHub Actions / GitLab CI)
5. Развертывание на продакшн-сервере

## 8. Дополнительные идеи для будущих версий:

### 8.1. Для разработки
- Использовать **Docker Compose** для поднятия локального окружения (PostgreSQL, pgAdmin, возможно Redis для кэша)
- Настроить **Swagger/OpenAPI** для документации API
- Использовать **Entity Framework Core** на бэкенде для работы с БД 
- На фронтенде использовать **TypeScript** строго, для уменьшения ошибок

### 8.2. Для улучшения UX
- Добавить **Skeleton Loading** для загрузки данных
- **Оптимистичные обновления** UI (например, при отметке задачи выполненной, не ждать ответа сервера)
- **Офлайн-режим** (сохранение задач локально в IndexedDB, синхронизация при появлении сети) — можно добавить в будущем

### 8.3. Для монетизации
- Возможно добавить **Team** тариф (общие проекты, командная аналитика)
- **Партнёрская программа** (привлечение друзей даёт скидку/бонусы)
- Продажа **тем/обоев** премиум-качества отдельно

### 8.4. Прочие
- Мобильное приложение (React Native / Flutter)
- Интеграция с календарём (Google Calendar, Outlook)
- Расширение для браузера (быстрый доступ к таймеру)
- Геймификация (ачивки, уровни, соревнования)






